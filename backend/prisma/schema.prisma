generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int              @id @default(autoincrement())
  firebase_uid      String           @unique
  email             String           @unique
  phone             String?
  role              String           @default("USER")
  is_verified       Boolean          @default(false)
  otp_code          String?
  otp_expiry        DateTime?
  avatar            String?
  created_at        DateTime         @default(now())
  consultant        Consultant?
  bookings          Booking[]
  messages          Message[]
  wallet            Wallet?
  transactions      Transaction[]
  paymentOrders     PaymentOrder[]
  reviews           Review[]
  supportTickets    SupportTicket[]
}

model Consultant {
  id                Int               @id @default(autoincrement())
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId            Int               @unique
  type              String?
  domain            String?
  bio               String?
  languages         String?
  profile_pic       String?
  hourly_price      Float?
  rating            Float             @default(0)
  total_reviews     Int               @default(0)
  is_verified       Boolean           @default(false)
  availability      Availability[]
  bookings          Booking[]
  slots             Slot[]
  reviews           Review[]
  supportTickets    SupportTicket[]
}

model Availability {
  id                Int        @id @default(autoincrement())
  consultant        Consultant @relation(fields: [consultantId], references: [id], onDelete: Cascade)
  consultantId      Int
  available_date    DateTime
  available_time    String
  is_booked         Boolean    @default(false)

  @@unique([consultantId, available_date, available_time])
}

model Booking {
  id                Int        @id @default(autoincrement())
  user              User       @relation(fields: [userId], references: [id])
  userId            Int
  consultant        Consultant @relation(fields: [consultantId], references: [id])
  consultantId      Int
  date              DateTime
  time_slot         String
  status            String     @default("CONFIRMED")
  is_paid           Boolean    @default(false)
  call_completed    Boolean    @default(false)
  call_duration     Int?
  consultant_fee    Float?
  commission_fee    Float?
  net_earning       Float?
  created_at        DateTime   @default(now())
  completed_at      DateTime?
  messages          Message[]
  payment           Payment?
  review            Review?
}

model Message {
  id                Int        @id @default(autoincrement())
  booking           Booking    @relation(fields: [bookingId], references: [id])
  bookingId         Int
  sender            User       @relation(fields: [senderId], references: [id])
  senderId          Int
  content           String
  created_at        DateTime   @default(now())
}

model Payment {
  id                Int        @id @default(autoincrement())
  booking           Booking    @relation(fields: [bookingId], references: [id])
  bookingId         Int        @unique
  amount            Float
  status            String
  razorpay_id       String?
  created_at        DateTime   @default(now())
}

model Wallet {
  id                Int        @id @default(autoincrement())
  userId            Int        @unique
  user              User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  balance           Float      @default(0)
  created_at        DateTime   @default(now())
  updated_at        DateTime   @updatedAt
}

model Transaction {
  id                Int        @id @default(autoincrement())
  user              User       @relation(fields: [userId], references: [id])
  userId            Int
  type              String
  amount            Float
  description       String?
  bookingId         Int?
  consultantId      Int?
  payment_method    String?
  status            String     @default("SUCCESS")
  created_at        DateTime   @default(now())
}

model CreditPackage {
  id                Int        @id @default(autoincrement())
  amount            Float
  bonus             Float      @default(0)
  is_active         Boolean    @default(true)
  created_at        DateTime   @default(now())
}

model Slot {
  id                String     @id @default(uuid())
  consultantId      Int
  date              DateTime
  startTime         String
  endTime           String
  createdAt         DateTime   @default(now())
  consultant        Consultant @relation(fields: [consultantId], references: [id])
}

model Review {
  id                Int        @id @default(autoincrement())
  booking           Booking    @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId         Int        @unique
  consultant        Consultant @relation(fields: [consultantId], references: [id], onDelete: Cascade)
  consultantId      Int
  user              User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId            Int
  rating            Int
  comment           String?
  created_at        DateTime   @default(now())
}

model SupportTicket {
  id                Int        @id @default(autoincrement())
  user              User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId            Int
  consultant        Consultant @relation(fields: [consultantId], references: [id], onDelete: Cascade)
  consultantId      Int
  subject           String
  category          String
  description       String
  status            String     @default("OPEN")
  priority          String     @default("MEDIUM")
  created_at        DateTime   @default(now())
  updated_at        DateTime   @updatedAt
}

model PaymentOrder {
  id                Int        @id @default(autoincrement())
  user              User       @relation(fields: [user_id], references: [id], onDelete: Cascade)
  user_id           Int
  razorpay_order_id String     @unique
  razorpay_payment_id String?
  razorpay_signature String?
  amount            Float
  credits           Float
  bonus             Float      @default(0)
  status            String     @default("PENDING")
  created_at        DateTime   @default(now())
  updated_at        DateTime   @updatedAt
}
